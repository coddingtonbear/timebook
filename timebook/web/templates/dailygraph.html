{% extends "base.html" %}

{% block extra_scripts %}
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
      google.load("visualization", "1", {packages:["corechart"]});
      google.load("jquery", "1.6.4");
      google.load("jqueryui", "1.8.16");
      google.setOnLoadCallback(drawChart);
      function drawChart()
      {
        var data = new google.visualization.DataTable();
        data.addColumn("string", "Date");
        data.addColumn("number", "% Billable");
        data.addRows([
          {% for d in billable_data %}["{{ d.0 }}", {{ d.1 }}]{% if not loop.last %},{% endif %}{% endfor %}
        ]);

        chart = new google.visualization.LineChart(document.getElementById('billable_chart_div'));
        chart.draw(data, {height: 800, title: 'Billable Percentage by Day'});

        var data2 = new google.visualization.DataTable();
        data2.addColumn("string", "Date");
        {% for client in client_list %}
          data2.addColumn("number", "{{ client.0 }}");
        {% endfor %}
        data2.addRows([
          {% for row in client_by_day %}
            {{ row|safe }}{% if not loop.last %},{% endif %}
          {% endfor %}
        ]);
        chart2 = new google.visualization.LineChart(document.getElementById('by_client_chart_div'));
        chart2.draw(data2, {height: 800, title: 'Project Time Allocation by Day'});


        $("#start_id").datepicker({
          dateFormat: "yy-mm-dd"
        });
        $("#end_id").datepicker({
          dateFormat: "yy-mm-dd"
        });
        {% if project %}
        $("#project_id").val("{{ project }}");
        {% endif %}
      }
    </script>
{% endblock %}
{% block styles %}
  {{ super() }}
  <link type="text/css" rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/ui-darkness/jquery-ui.css" />
  <style type="text/css">
    div.content {
      width: 100%;
    }
    div#lede {
      text-align: center;
    }
    div#lede form {
      width: 400px;
      margin: 0 auto;
    }
  </style>
{% endblock %}

{% block content %}
    <a href="/">&rarr; Home</a>
    <div id="lede">
      <h1>Time Allocation Charts</h1>
      <form method="GET">
        <input type="date" name="start" id="start_id" value="{{ start }}" />
        <input type="date" name="end" id="end_id" value="{{ end }}" />
        <select name="project" id="project_id">
          <option value="">All Projects<option>
          {% for client in all_client_list %}
            <option value="{{ client.0 }}">{{ client.0 }}</option>
          {% endfor %}
        </select>
        <input type="submit" value="Go" />
      </form>
    </div>
    <div id="by_client_chart_div"></div>
    <div id="billable_chart_div"></div>
{% endblock %}
